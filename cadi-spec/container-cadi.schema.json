{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cadi.dev/schemas/container-cadi.schema.json",
  "title": "Container CADI Schema",
  "description": "Schema for OCI container chunks - deployable container images",
  "allOf": [
    {"$ref": "chunk.schema.json"}
  ],
  "type": "object",
  "required": ["container"],
  "properties": {
    "cadi_type": {
      "const": "container"
    },
    "container": {
      "type": "object",
      "required": ["format", "image_ref"],
      "properties": {
        "format": {
          "type": "string",
          "const": "oci",
          "description": "Container format (OCI)"
        },
        "image_ref": {
          "type": "string",
          "description": "OCI image reference (e.g., ghcr.io/org/todo-node@sha256:...)"
        },
        "layers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["hash", "size"],
            "properties": {
              "hash": {
                "type": "string",
                "pattern": "^sha256:[a-f0-9]{64}$",
                "description": "Layer content hash"
              },
              "size": {
                "type": "integer",
                "minimum": 0,
                "description": "Layer size in bytes"
              },
              "description": {
                "type": "string",
                "description": "Human-readable layer description"
              },
              "cadi_chunk": {
                "type": ["string", "null"],
                "description": "Link to underlying CADI chunk if applicable"
              }
            }
          },
          "description": "Container image layers"
        },
        "entrypoint": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Container entrypoint command"
        },
        "cmd": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Default command arguments"
        },
        "environment": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "value"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Environment variable name"
              },
              "value": {
                "type": "string",
                "description": "Environment variable value"
              }
            }
          },
          "description": "Default environment variables"
        },
        "exposed_ports": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^\\d+/(tcp|udp)$"
          },
          "description": "Exposed ports (e.g., 8080/tcp)"
        },
        "labels": {
          "type": "object",
          "additionalProperties": {"type": "string"},
          "description": "OCI image labels"
        },
        "architecture": {
          "type": "string",
          "description": "Target architecture for the container"
        },
        "os": {
          "type": "string",
          "default": "linux",
          "description": "Target operating system"
        }
      }
    },
    "deployment_target": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["docker", "kubernetes", "podman", "serverless"]
      },
      "description": "Supported deployment targets"
    },
    "sbom": {
      "type": "object",
      "properties": {
        "format": {
          "type": "string",
          "enum": ["spdx", "cyclonedx"],
          "description": "SBOM format"
        },
        "hash": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$",
          "description": "SBOM content hash"
        }
      },
      "description": "Software Bill of Materials"
    }
  }
}
